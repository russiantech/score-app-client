import{r as i,j as s,a as v,u as j,N as h,L as S,A as b}from"./index-Bhp7YlUb.js";import{A as N}from"./AuthHeader-DAwxNHMC.js";const w=({value:o,onChange:x,length:n=6,disabled:y=!1})=>{const[c,p]=i.useState(Array(n).fill("")),l=i.useRef([]);i.useEffect(()=>{const e=Array(n).fill("");o.split("").forEach((a,t)=>{t<n&&(e[t]=a)}),p(e)},[o,n]);const f=e=>{p(e),x(e.join(""))},m=(e,a)=>{const t=a.replace(/[^a-zA-Z0-9]/g,"").toUpperCase();if(!t)return;const r=[...c];r[e]=t[0],f(r),e<n-1&&l.current[e+1]?.focus()},g=(e,a)=>{if(a.key==="Backspace"){a.preventDefault();const t=[...c];t[e]?t[e]="":e>0&&(t[e-1]="",l.current[e-1]?.focus()),f(t)}},d=e=>{e.preventDefault();const a=e.clipboardData.getData("text").replace(/[^a-zA-Z0-9]/g,"").toUpperCase().slice(0,n),t=Array(n).fill("");a.split("").forEach((r,u)=>t[u]=r),f(t),l.current[Math.min(a.length,n-1)]?.focus()};return s.jsx("div",{className:"d-flex justify-content-center gap-2",children:c.map((e,a)=>s.jsx("input",{ref:t=>{l.current[a]=t},value:e,disabled:y,inputMode:"text",maxLength:1,onChange:t=>m(a,t.target.value),onKeyDown:t=>g(a,t),onPaste:d,className:"form-control text-center",style:{width:44,height:48,fontSize:"1.2rem",fontWeight:600}},a))})},D=()=>{const o=v(),{verifySignup:x}=j(),[n,y]=i.useState(null),[c,p]=i.useState(""),[l,f]=i.useState(!1),[m,g]=i.useState(!1),[d,e]=i.useState(600);i.useEffect(()=>{const r=sessionStorage.getItem("verification_data");if(!r){o("/auth/signup");return}const u=JSON.parse(r);y(u),e(u.expires_in_seconds??600)},[o]),i.useEffect(()=>{if(d<=0){sessionStorage.removeItem("verification_data"),h.showToast("Verification expired. Please sign up again.","error"),o("/auth/signup");return}const r=setInterval(()=>e(u=>u-1),1e3);return()=>clearInterval(r)},[d,o]);const a=async r=>{if(r.preventDefault(),!(!n||c.length!==6)){f(!0);try{const u={token:n.token,email_code:c};await x(u),h.showToast("Account verified successfully","success"),o("/auth/signin")}finally{f(!1)}}},t=async()=>{if(!(!n||m)){g(!0);try{h.showToast("Resending verification code…","info"),await b.resendVerificationCode({token:n.token,type:"email"}),e(600),p(""),h.showToast("Verification code resent successfully","success")}catch(r){h.showToast(r?.message||"Failed to resend code. Please try again.","error")}finally{g(!1)}}};return n?s.jsx("main",{className:"page-content",children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"dz-authentication-area",children:[s.jsx(N,{}),s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("h3",{children:"Verify your account"}),s.jsxs("p",{className:"text-muted",children:["Enter the 6-digit code sent to ",s.jsx("strong",{children:n.email})]}),s.jsxs("small",{className:"text-warning",children:["Expires in ",Math.floor(d/60),":",(d%60).toString().padStart(2,"0")]})]}),s.jsxs("form",{onSubmit:a,children:[s.jsx(w,{value:c,onChange:p,disabled:l}),s.jsx("button",{type:"submit",className:"btn btn-primary w-100 mt-4",disabled:l||c.length!==6,children:l?"Verifying…":"Verify"}),s.jsx("div",{className:"text-center mt-3",children:s.jsx("button",{type:"button",onClick:t,className:"btn btn-link p-0",disabled:m||d>540,children:m?"Resending…":"Didn’t receive a code? Resend"})}),s.jsx("div",{className:"text-center mt-3",children:s.jsx(S,{to:"/auth/signup",className:"text-muted border border-secondary  p-1 rounded-2",children:"Back to Sign Up"})})]})]})})}):null};export{D as default};
